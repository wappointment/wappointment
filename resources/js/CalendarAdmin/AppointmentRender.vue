<script>
export default {
    methods:{
        getClientAppointment(appointment){
          let testAppointment = ''
          if(appointment.extendedProps.client.options !== undefined && appointment.extendedProps.client.options.test_appointment !== undefined){
            testAppointment = 'This is a test appointment, you can delete it safely'
          }
            return`<div>
                    <div>${this.getClientAvatarName(appointment)} </div>
                    <div>Email: ${appointment.extendedProps.client.email} </div>
                    ${this.getAllAppointmentOptions(appointment)}`+
                    (testAppointment == '' ? '':`<div class="text-primary">${testAppointment}</div>`)
                   +`</div>`

        },
        getAppointmentInfoHTML(appointment, delta = false){
            return (delta !== false) ? this.getOldAndNewAppointment(appointment, delta):this.getScheduledTime(appointment)
        },

        getScheduledTime(appointment){
            return `
                <div class="d-sm-flex justify-content-around align-items-center my-2">
                ${this.getClientAppointment(appointment)}
                
                <div class="bg-light border border-primary rounded p-2 text-center">
                    <div> Scheduled Time </div>
                    ${this.getIconClass(appointment.extendedProps.location)} ${this.getAppointmentTimeAndDate(this.toMoment(appointment.start), this.toMoment(appointment.end))}
                </div>
                </div>
            `
        },

      
        getOldAndNewAppointment(appointment, delta){

            let dms = -delta.milliseconds
            let daysdelta = -delta.days
            
            let oldStart = this.toMoment(appointment.start).clone().add(dms, 'ms').add(daysdelta, 'd')
            let oldEnd = this.toMoment(appointment.end).clone().add(dms, 'ms').add(daysdelta, 'd')
            return `
                <div class="text-center">${this.getClientAppointment(appointment)}<hr></div>
                <div class="d-sm-flex justify-content-around align-items-center my-2 text-center">
                    <div class="bg-light rounded p-2">
                    <div> Old schedule </div>
                    ${this.getAppointmentTimeAndDate(oldStart, oldEnd, 'text-danger')}
                    </div>
                    <div class="d-sm-block d-none"> <span class="dashicons dashicons-arrow-right-alt2"></span> </div>
                    <div class="d-sm-none"> <span class="dashicons dashicons-arrow-down-alt2"></span> </div>
                    <div class="bg-light border border-primary rounded p-2">
                    <div> New schedule </div>
                    ${this.getAppointmentTimeAndDate(this.toMoment(appointment.start), this.toMoment(appointment.end), 'text-success')}
                    </div>  
                </div>
            `
        },

        getAppointmentTimeAndDate(momentStart, momentEnd, className=''){
            return `<div>
                    <div class="${className}"> 
                    ${ this.formatTime(momentStart, this.viewData.date_format ) } 
                    </div>
                    <div class="${className}">
                    From ${this.formatTime(momentStart)} until ${this.formatTime(momentEnd)} 
                    </div>
                    <div class="small font-italic">${this.displayTimezone}</div>
                </div>`
        },
      getBuffer(event){
        return [undefined,null].indexOf(event.extendedProps)===-1  && 
        [undefined,null].indexOf(event.extendedProps.options)===-1 && 
        event.extendedProps.options.buffer_time !== undefined ? event.extendedProps.options.buffer_time:0
      },
      getBufferHtml(event){
        return this.getBuffer(event) > 0 ?`<div class="buffer">Buffer: ${this.getBuffer(event)}min</div>`:''
      },
      getService(event){
        let duration = (this.toMoment(event.end).unix()-this.toMoment(event.start).unix()- (this.getBuffer(event)*60))/60
        return `<div>${this.viewData.service.name} : ${duration}min </div>`
      },

        // appointment cell
      getAppointmentHtml(event){

        if(event.extendedProps.client === null) return ''
        
        return `<div class="d-flex">
                  <div> ${this.getClientAvatarSize(event)} </div>
                  <div class="ml-1">
                  <div class="client-name"> ${event.extendedProps.client.name} </div> 
                  <div class="time">${this.getIconClass(event.extendedProps.location)} ${this.formatTime(this.toMoment(event.start))}  -  ${this.formatTime(this.toMoment(event.end))}</div>
                  </div>
                </div>`
      },
      getIconClass(string){
        switch (string) {
          case 'skype':
            return '<svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="skype" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-skype fa-w-14 fa-lg"><path fill="currentColor" d="M424.7 299.8c2.9-14 4.7-28.9 4.7-43.8 0-113.5-91.9-205.3-205.3-205.3-14.9 0-29.7 1.7-43.8 4.7C161.3 40.7 137.7 32 112 32 50.2 32 0 82.2 0 144c0 25.7 8.7 49.3 23.3 68.2-2.9 14-4.7 28.9-4.7 43.8 0 113.5 91.9 205.3 205.3 205.3 14.9 0 29.7-1.7 43.8-4.7 19 14.6 42.6 23.3 68.2 23.3 61.8 0 112-50.2 112-112 .1-25.6-8.6-49.2-23.2-68.1zm-194.6 91.5c-65.6 0-120.5-29.2-120.5-65 0-16 9-30.6 29.5-30.6 31.2 0 34.1 44.9 88.1 44.9 25.7 0 42.3-11.4 42.3-26.3 0-18.7-16-21.6-42-28-62.5-15.4-117.8-22-117.8-87.2 0-59.2 58.6-81.1 109.1-81.1 55.1 0 110.8 21.9 110.8 55.4 0 16.9-11.4 31.8-30.3 31.8-28.3 0-29.2-33.5-75-33.5-25.7 0-42 7-42 22.5 0 19.8 20.8 21.8 69.1 33 41.4 9.3 90.7 26.8 90.7 77.6 0 59.1-57.1 86.5-112 86.5z" class=""></path></svg>'
            return 'fab fa-skype'
          case 'zoom':
            return '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="video" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline--fa fa-video fa-w-18 fa-2x"><path fill="currentColor" d="M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z" class=""></path></svg>'
            return 'fas fa-video'
          case 'phone':
            return '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-phone fa-w-16 fa-lg"><path fill="currentColor" d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z" class=""></path></svg>'
            return 'fas fa-phone'
          case 'physical':
            return '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marked-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline--fa fa-map-marked-alt fa-w-18 fa-lg"><path fill="currentColor" d="M288 0c-69.59 0-126 56.41-126 126 0 56.26 82.35 158.8 113.9 196.02 6.39 7.54 17.82 7.54 24.2 0C331.65 284.8 414 182.26 414 126 414 56.41 357.59 0 288 0zm0 168c-23.2 0-42-18.8-42-42s18.8-42 42-42 42 18.8 42 42-18.8 42-42 42zM20.12 215.95A32.006 32.006 0 0 0 0 245.66v250.32c0 11.32 11.43 19.06 21.94 14.86L160 448V214.92c-8.84-15.98-16.07-31.54-21.25-46.42L20.12 215.95zM288 359.67c-14.07 0-27.38-6.18-36.51-16.96-19.66-23.2-40.57-49.62-59.49-76.72v182l192 64V266c-18.92 27.09-39.82 53.52-59.49 76.72-9.13 10.77-22.44 16.95-36.51 16.95zm266.06-198.51L416 224v288l139.88-55.95A31.996 31.996 0 0 0 576 426.34V176.02c0-11.32-11.43-19.06-21.94-14.86z" class=""></path></svg>'
            return 'fas fa-map-marked-alt'
        }
        return ''
      },

      getClientAvatarSize(appointment, size = 30){
        return `<img class="rounded-circle" src="${appointment.extendedProps.client.avatar.replace('s=30', 's='+size)}" title="${appointment.extendedProps.client.name}">`
      },
      getClientAvatarName(appointment){
        return `${this.getClientAvatarSize(appointment, 60)} ${appointment.extendedProps.client.name}`
      },
      getAllAppointmentOptions(appointment){
        let clientoptions = ''
        for (const key in appointment.extendedProps.client.options) {
          if (appointment.extendedProps.client.options.hasOwnProperty(key)) {
            const element = appointment.extendedProps.client.options[key];
            if(appointment.extendedProps.client.options[key]!= '') {
              clientoptions += `<div> ${key}: ${appointment.extendedProps.client.options[key]} </div>`
            }
          }
        }
        return clientoptions
      },

    }
}   
</script>

